"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}window.addEventListener("DOMContentLoaded",function(){function w(e,t,n){var r=e.length;if(0===r)return[];var o,c=0,i=[];for(n||(t=t.toLowerCase(),e=e.toLowerCase());-1<(o=t.indexOf(e,c));)i.push({position:o,word:e}),c=o+r;return i}function x(e,t,n,r){for(var o=n[n.length-1],c=o.position,i=o.word,a=[],l=0;c+i.length<=t&&0!==n.length;){i===r&&l++,a.push({position:c,length:i.length});var s=c+i.length;for(n.pop();0!==n.length&&(c=(o=n[n.length-1]).position,i=o.word,c<s);)n.pop()}return{hits:a,start:e,end:t,searchTextCount:l}}function L(n,e){var r="",o=e.start;return e.hits.forEach(function(e){r+=n.substring(o,e.position);var t=e.position+e.length;r+='<b class="search-keyword">'+n.substring(e.position,t)+"</b>",o=t}),r+=n.substring(o,e.end)}function t(){var t,v=s.value.trim().toLowerCase(),C=v.split(/[-\s]+/),m=(1<C.length&&C.push(v),[]);0<v.length&&i.forEach(function(e){if(e.title){var t=0,n=e.title.trim(),r=n.toLowerCase(),o=e.content?e.content.trim().replace(/<[^>]+>/g,""):"",c=(o=CONFIG.localsearch.unescape?String(o).replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#x3A;/g,":").replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(t)}).replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"):o).toLowerCase(),i=decodeURIComponent(e.url).replace(/\/{2,}/g,"/"),a=[],l=[];if(C.forEach(function(e){a=a.concat(w(e,r,!1)),l=l.concat(w(e,c,!1))}),0<a.length||0<l.length){for(var e=a.length+l.length,s=([a,l].forEach(function(e){e.sort(function(e,t){return t.position!==e.position?t.position-e.position:e.word.length-t.word.length})}),[]),u=(0!==a.length&&(t+=(g=x(0,n.length,a,v)).searchTextCountInSlice,s.push(g)),[]);0!==l.length;){var h=l[l.length-1],p=h.position,h=h.word,d=p-20,f=p+80,p=(d<0&&(d=0),(f=f<p+h.length?p+h.length:f)>o.length&&(f=o.length),x(d,f,l,v));t+=p.searchTextCountInSlice,u.push(p)}u.sort(function(e,t){return e.searchTextCount!==t.searchTextCount?t.searchTextCount-e.searchTextCount:e.hits.length!==t.hits.length?t.hits.length-e.hits.length:e.start-t.start});var g=parseInt(CONFIG.localsearch.top_n_per_article,10),y=(0<=g&&(u=u.slice(0,g)),"");0!==s.length?y+='<li><a href="'+i+'" class="search-result-title">'+L(n,s[0])+"</a>":y+='<li><a href="'+i+'" class="search-result-title">'+n+"</a>",u.forEach(function(e){y+='<a href="'+i+'"><p class="search-result">'+L(o,e)+"...</p></a>"}),y+="</li>",m.push({item:y,searchTextCount:t,hitCount:e,id:m.length})}}}),1===C.length&&""===C[0]?u.innerHTML='<div id="no-result"><i class="fa fa-search fa-5x"></i></div>':0===m.length?u.innerHTML='<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>':(m.sort(function(e,t){return e.searchTextCount!==t.searchTextCount?t.searchTextCount-e.searchTextCount:e.hitCount!==t.hitCount?t.hitCount-e.hitCount:t.id-e.id}),t='<ul class="search-result-list">',m.forEach(function(e){t+=e.item}),t+="</ul>",u.innerHTML=t,window.pjax&&window.pjax.refresh(u))}function n(t){fetch(l).then(function(e){return e.text()}).then(function(e){c=!0,i=a?[].concat(_toConsumableArray((new DOMParser).parseFromString(e,"text/xml").querySelectorAll("entry"))).map(function(e){return{title:e.querySelector("title").innerHTML,content:e.querySelector("content").innerHTML,url:e.querySelector("url").innerHTML}}):JSON.parse(e),document.querySelector(".search-pop-overlay").innerHTML="",document.body.style.overflow="",t&&t()})}function r(){document.body.style.overflow="hidden",document.querySelector(".search-pop-overlay").style.display="block",document.querySelector(".popup").style.display="block",document.querySelector(".search-input").focus()}function o(){document.body.style.overflow="",document.querySelector(".search-pop-overlay").style.display="none",document.querySelector(".popup").style.display="none"}var c=!1,i=void 0,a=!0,e=CONFIG.path,l=(0===e.length?e="search.xml":/json$/i.test(e)&&(a=!1),CONFIG.root+e),s=document.querySelector(".search-input"),u=document.getElementById("search-result");CONFIG.localsearch.preload&&n(),"auto"===CONFIG.localsearch.trigger?s.addEventListener("input",t):(document.querySelector(".search-icon").addEventListener("click",t),s.addEventListener("keypress",function(e){"Enter"===e.key&&t()})),document.querySelectorAll(".popup-trigger").forEach(function(e){e.addEventListener("click",function(){c?r():(document.querySelector(".search-pop-overlay").style.display="",document.querySelector(".search-pop-overlay").innerHTML='<div class="search-loading-icon"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div>',n(r))})});document.querySelector(".search-pop-overlay").addEventListener("click",o),document.querySelector(".popup-btn-close").addEventListener("click",o),window.addEventListener("pjax:success",o),window.addEventListener("keyup",function(e){"Escape"===e.key&&o()})});